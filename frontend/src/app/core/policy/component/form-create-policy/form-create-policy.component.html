<form
  [formGroup]="policyForm"
  (ngSubmit)="createPolicy()"
>

  <h2>Subscribe to new policy</h2>

  <div class="col-item">
    <mat-form-field class="form-field-basic">
      <mat-label>Linked Account</mat-label>

      <mat-select formControlName="accountId">
        @if (userAccounts.length === 0) {
          <mat-option value="" disabled>No accounts found</mat-option>
        }
        @else {
          <mat-option value="" disabled></mat-option>
          @for (account of userAccounts; track account.id) {
            <mat-option [value]="account.id">
              {{ account.accountNumber }} (${{ account.balance.toFixed(2) }})
            </mat-option>
          }
        }
      </mat-select>

      @if (policyForm.get('accountId')?.hasError('required')) {
        <mat-error>Linked Account is required</mat-error>
      }
    </mat-form-field>
  </div>

  <div class="col-item">
    <mat-form-field class="form-field-basic">
      <mat-label>Policy Type</mat-label>

      <mat-select formControlName="policyType">
          <mat-option value="" disabled></mat-option>
          @for (type of policyTypes; track type) {
            <mat-option [value]="type">
              {{ type }}
            </mat-option>
          }
      </mat-select>

      @if (policyForm.get('policyType')?.hasError('required')) {
        <mat-error>Policy Type is required</mat-error>
      }
    </mat-form-field>
  </div>

  <div class="col-item">
    <mat-form-field class="form-field-basic">
      <mat-label>Coverage Amount</mat-label>

      <input matInput
        formControlName="coverageAmount"
        placeholder="Ex: 100"
      />

      @if (policyForm.get('coverageAmount')?.hasError('required')) {
        <mat-error>Coverage Amount is required</mat-error>
      }
      @if (policyForm.get('coverageAmount')?.hasError('pattern')) {
        <mat-error>Coverage Amount must be a positive number</mat-error>
      }
    </mat-form-field>
  </div>

  <div class="col-item">
    <button mat-flat-button type="submit" [disabled]="!policyForm.valid">
      Subscribe
    </button>
  </div>

</form>
