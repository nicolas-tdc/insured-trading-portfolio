<form
  [formGroup]="policyForm"
  (ngSubmit)="createPolicy()"
>

  <h3>Subscribe to a new policy</h3>

    <mat-form-field>
      Policy Type

      <mat-select formControlName="policyType">
          <mat-option value="" disabled></mat-option>
          <mat-option *ngFor="let type of policyTypes" [value]="type">
            {{ type }}
          </mat-option>
      </mat-select>

      @if (policyForm.get('policyType')?.hasError('required')) {
        <mat-error>Policy Type is required</mat-error>
      }

    </mat-form-field>

    <mat-form-field>
      Coverage Amount

      <input matInput
        formControlName="coverageAmount"
        placeholder="Ex: 100"
      />

      @if (policyForm.get('coverageAmount')?.hasError('required')) {
        <mat-error>Coverage Amount is required</mat-error>
      }
      @if (policyForm.get('coverageAmount')?.hasError('pattern')) {
        <mat-error>Coverage Amount must be a positive number</mat-error>
      }

    </mat-form-field>

    <mat-form-field>
      Linked Account

      <mat-select formControlName="accountId">
        @if (accounts.length === 0) {
          <mat-option value="" disabled>No accounts found</mat-option>
        }
        @else {
          <mat-option value="" disabled></mat-option>
          @for (account of accounts; track account.id) {
            <mat-option>
              {{ account.accountNumber }} (${{ account.balance.toFixed(2) }})
            </mat-option>
          }
        }
      </mat-select>

      @if (policyForm.get('accountId')?.hasError('required')) {
        <mat-error>Linked Account is required</mat-error>
      }

    </mat-form-field>

    <button mat-flat-button type="submit" [disabled]="!policyForm.valid">
      Subscribe
    </button>

</form>
